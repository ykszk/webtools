<head>
    <title>Command Generator</title>
    <style type="text/css">
     html{
         background-color:#FFFDF3;
     }
     body{
         background-color:#ffffff;
         color : #000000;
         margin-right: auto;
         margin-left : auto;
         padding:30px;
         border:4px solid #E8DB6D;
         width:1100px;
     }
     h1,h2,h3{
         margin: 2px;
     }
     textarea,pre{
         font-family:"Courier New", Consolas, monospace;
     }
     pre{
         background-color:#eeeeee;
         padding:10px;
         border:2px solid #cccccc;
    </style>
</head>
<body>
    <h1>Command Generator</h1>
    <form name="template_form">
        <h3>template</h3>
        <textarea name="template" rows="2" cols="130" placeholder="python3 script.py ?{var0}"></textarea>
    </form>
    <form name="form0">
        <h3>variable</h3>
        name:<input type="text" name="varname" value="var0"><br>
        <textarea name="list" rows="20" cols="60" placeholder="Alice&#13;&#10;Bob&#13;&#10;Charlie&#13;&#10;Dave"></textarea>
    </form>
    <form name="output">
        <h3>output</h3>
        <textarea name="output" rows="20" cols="130" placeholder="python3 script.py Alice&#13;&#10;python3 script.py Bob&#13;&#10;python3 script.py Charlie&#13;&#10;python3 script.py Dave"></textarea>
    </form>
    <div style="display:inline-flex">
        <input id="generate_button" type="button" value="Generate" onclick="generate()"><br>
        <input id="save_button" type="button" value="Save" onclick="encode_params()"><br>
        <input id="reset_button" type="button" value="Reset" onclick="reset()"><br>
    </div>
    <div>
        <details>
            <summary>Advanced</summary>
            <form name="advanced">
                <input type="checkbox" name="skip_empty" value="1" checked="checked">Skip empty line
            </form>
        </details>
        <details open="true">
            <summary>Snippets</summary>
            <pre>
sbatch --gres=gpu:1 -c 4 -D $(pwd) --wrap="singularity exec --nv -B /win/salmon/user /simg/AIO.simg python3"
sbatch --gres=gpu:1 -c 4 -D $(pwd) --wrap=""
singularity exec --nv -B /win/salmon/user /simg/AIO.simg python3
-B /win/scallop/user
</pre>
        </details>
    </div>


    <script>

     function decode_params()
     {
         text = location.search.substr(1);
         sep = '&';
         eq = '=';
         params = text.split(sep).reduce(function(obj, v) {
             var pair = v.split(eq);
             obj[pair[0]] = decodeURIComponent(pair[1]);
             return obj;
         }, {});
         if (params['template']) {
             document.template_form.template.value = decodeURIComponent(params['template']);
         }
         if (params['var0']) {
             document.form0.list.value = decodeURIComponent(params['var0']);
         }
     }
     function encode_params()
     {
         params = {'template':document.template_form.template.value, 'var0':document.form0.list.value};
         filtered_params = ['template','var0'].filter(key => params[key]);
         if (filtered_params.length > 0) {
             params_str = filtered_params.map(key => key+'='+encodeURIComponent(params[key])).reduce((a,b) => a+'&'+b)
             new_uri = (location.pathname.split('/').pop()+'?'+params_str);
             history.replaceState({},'',new_uri);
         } else {
             new_uri = (location.pathname.split('/').pop());
             history.replaceState({},'',new_uri);
         }
     }
     function generate() {
         var template=document.template_form.template.value;
         var list =document.form0.list.value.split("\n").map(a=>a.replace('\r',''));
         if (document.advanced.skip_empty.checked) {
             list = list.filter(a=>a.length>0)
         }

         var re = new RegExp("\\?{"+document.form0.varname.value+"}","g");
         replaced = list.map(e => template.replace(re,e));
         catted = replaced.reduce((a,b)=>a+"\n"+b);
         document.output.output.value = catted + '\n';
     }
     function reset()
     {
         document.template_form.template.value='';
         document.form0.list.value='';
         console.log(document.form0.list.value);
         document.output.output.value='';
         encode_params();
     }
     decode_params();
    </script>
</body>
